
////////////////////////////////////////////////////////////////////////////////
// K

$color-accent: #0b9a9a
$color-accent2: #057d7d
$color-bg: #f7f7f7
$color-header-bg-left: $color-accent
$color-header-bg-right: $color-accent2
$color-sidebar-bg-active: #44444b
$color-sidebar-bg: #33333b
$color-sidebar-bg2: #2d2d31
$color-sidebar-bg3: #1c1c22
$color-splash: #085b5b
$color-heading: #000
$color-text: #333
$color-success: #4c4
$color-error: #c44

$header-height: 12rem
$header-overdraw: 20rem
$logo-size: 7.2em
$sidebar-padding: 2.5rem
$sidebar-width: 28rem
$main-padding: 4rem
$main-max-width: 65rem
$repl-left-gutter: 12rem

$font-title: 'malaga-narrow', 'Helvetica Neue', Helvetica, Arial, sans-serif
$font-heading: malaga, 'Helvetica Neue', Helvetica, Arial, sans-serif
$font-body: ratio, 'Helvetica Neue', Helvetica, Arial, sans-serif
$font-monospace: menlo, monaco, inconsolata, consolas, monospace

$z-mobile-toc: 1
$z-toc-api-object: 1
$z-api-find: 2
$z-toc-toplevel-entry: 3
$z-header-base: 100
$z-header: 101
$z-repl: 150
$z-sheets: 199
$z-flyout: 200
$z-tooltip: 500

$icon-add-circle: '\e90e'
$icon-add: '\e910'
$icon-arrow-right: '\e900'
$icon-chevron-down: '\e90a'
$icon-chevron-right: '\e90b'
$icon-delete: '\e901'
$icon-close: '\e902'
$icon-close-small: '\e90c'
$icon-close-circle: '\e903'
$icon-console-add: '\e90d'
$icon-pencil: '\e904'
$icon-replay-all: '\e905'
$icon-pin: '\e906'
$icon-play: '\e907'
$icon-revert: '\e908'
$icon-swap: '\e911'
$icon-window: '\e909'
$icon-window-up: '\e90f'

$subtle-shadow: 0 0.3em 0.5em rgba(0, 0, 0, 0.12)

$ease-extreme-out: cubic-bezier(.05, .9, 0, 1)


////////////////////////////////////////////////////////////////////////////////
// UTIL

@mixin fill($buffer: 0)
  bottom: 0
  left: 0
  position: absolute
  right: 0
  top: 0

@mixin reify
  content: ''
  display: block


////////////////////////////////////////////////////////////////////////////////
// COMMON

@mixin custom-scrollbar($color-thumb: $color-accent, $color-gutter: rgba(0, 0, 10, 0.8))
  &::-webkit-scrollbar
    background: $color-gutter
    width: 0.9em

  &::-webkit-scrollbar-thumb
    background: $color-thumb

@mixin icon($which: null)
  @if $which
    content: $which
  font-family: 'icons' !important
  -webkit-font-smoothing: antialiased
  -moz-osx-font-smoothing: grayscale
  font-style: normal
  font-variant: normal
  font-weight: normal
  line-height: 1
  speak: none
  text-transform: none

@mixin no-appearance
  background: none
  border: none
  margin: 0
  outline: none
  padding: 0


////////////////////////////////////////////////////////////////////////////////
// IMPORTS / EXTERNS

@import '../node_modules/codemirror/lib/codemirror'
@import '../node_modules/janus-inspect/lib/inspect'

@font-face
  font-family: 'icons';
  src: url('/assets/icons.eot?d')
  src: url('/assets/icons.eot?d#iefix') format('embedded-opentype'), url('/assets/icons.ttf?d') format('truetype'), url('/assets/icons.woff?d') format('woff'), url('/assets/icons.svg?d#icomoon') format('svg')
  font-weight: normal
  font-style: normal


////////////////////////////////////////////////////////////////////////////////
// RESET

html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p,
blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em,
font, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var,
b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend,
table, caption, tbody, tfoot, thead, tr, th, td
  background: transparent
  border: 0
  margin: 0
  outline: 0
  padding: 0
  vertical-align: baseline

html
  color: $color-text
  font-family: $font-body
  font-size: 62.5%

body
  background-color: $color-sidebar-bg

ul, ol
  list-style-type: none


////////////////////////////////////////////////////////////////////////////////
// GLOBAL

.hide
  display: none !important


////////////////////////////////////////////////////////////////////////////////
// LAYOUT

////////////////////////////////////////
// LAYOUT: base

header
  color: #fff
  left: 0
  position: fixed
  top: 0
  right: 0
  z-index: $z-header-base

  &:before, &:after
    @include reify
    position: absolute
    transform: skewY(-3deg)
    transform-origin: left center

  &:before
    background: $color-header-bg-left
    box-shadow: 0 0 1.2em rgba(0, 0, 0, 0.8)
    left: 0
    height: $header-height + $header-overdraw + 2rem
    top: -1.3rem - $header-overdraw
    width: $sidebar-width
    z-index: $z-header

  &:after
    background: $color-header-bg-right
    height: $header-height + $header-overdraw
    left: $sidebar-width
    right: 0
    top: -$header-overdraw

  .header-left
    padding: 3em
    position: absolute
    z-index: $z-header

  .header-right
    left: $sidebar-width
    padding: $main-padding
    position: absolute
    z-index: $z-header

  #show-toc
    @include no-appearance
    cursor: pointer
    display: none
    position: absolute
    right: 3em
    top: 4.3em
    z-index: $z-header

    &:after
      $size: 0.4em
      @include reify
      border: $size solid transparent
        bottom: none
        top-color: #fff
      left: calc(100% + 0.5em)
      position: absolute
      top: calc(50% - #{$size / 2})
      transition: transform 0.2s

    .icon
      $height: 0.9em
      $width: 1.4em
      border-bottom: 2px solid #fff
      border-top: 2px solid #fff
      height: $height
      width: $width

      &:before
        @include reify
        border-bottom: 2px solid #fff
        height: calc(#{$height / 2} - 1px)
        width: $width

  #logo
    border: 3px solid rgba(255, 255, 255, 0.1)
    border-radius: 9999px
    float: left
    height: $logo-size
    margin-right: 1.5em
    margin-top: -0.7em
    width: $logo-size

    svg path
      fill: #fff

  h1
    float: left
    font-family: $font-title
    font-size: 4em
    font-weight: 400
    line-height: 1em

  a
    border-bottom: 1px dotted rgba(255, 255, 255, 0.2)
    color: #fff
    text-decoration: none
    transition: 0.1s border-color

    &:hover
      border-bottom-color: #fff

  nav
    font-family: $font-title
    font-size: 2em

    a
      margin-right: 1em
      text-transform: lowercase

#left
  @include fill
  background: $color-sidebar-bg
  box-shadow: 0 -0.6em 0.6em rgba(0, 0, 0, 0.45)
  position: fixed
  right: auto
  width: $sidebar-width

  nav
    @include fill
    @include custom-scrollbar
    overflow-x: hidden
    overflow-y: auto
    top: $header-height - 1rem

    > ul
      padding-top: $main-padding

  .toc-entry
    $vpadding: 0.8rem
    $indent: 1.5rem

    &.active
      > a, > a:hover
        background: $color-accent

    a
      border-bottom: 1px solid $color-sidebar-bg2
      color: #fff
      display: block
      font-family: $font-title
      font-size: 2.2rem
      padding: $vpadding $sidebar-padding
      text-decoration: none
      transition: 0.2s background

      &:hover
        background: $color-sidebar-bg-active
        transition: none

    > a
      // get the API Reference header to show over the 
      position: relative
      z-index: $z-toc-toplevel-entry

    ul
      padding-bottom: 1.5rem

    .toc-entry
      a
        background: #2d2d31
        border-bottom-color: $color-sidebar-bg
        font-family: $font-body
        font-size: 1.5rem
        padding: $vpadding 1rem
          left: $sidebar-padding + $indent

        // TODO: these layered overrides are incredibly irritating.
        &:hover
          background: $color-sidebar-bg-active

      &.active
        a, a:hover
          background: $color-accent

      .toc-entry a
        padding-left: $sidebar-padding + ($indent * 2)

    .toc-children
      display: none
    &.prefix .toc-children
      display: block

  .api-browser
    background: $color-sidebar-bg3
    color: #fff

    .api-find
      $overdraw: 2rem
      background: $color-sidebar-bg
      border-bottom: 1px solid $color-accent2
      margin-top: -$overdraw
      padding-top: $overdraw
      position: sticky
      top: 0
      z-index: $z-api-find

      input
        @include no-appearance
        background: $color-sidebar-bg2
        color: #fff
        font-family: $font-body
        font-size: 1.3em
        padding: 0.8em 1em
          left: $sidebar-padding
        width: 100%

      button
        $offset: 0.6rem
        $size: 1.8em
        background: none
        border: none
        bottom: $offset
        color: #fff
        display: block
        font-size: 2em
        position: absolute
        right: $offset

    .api-sections
      padding-top: 1em

    .api-section
      .api-section-header
        @include no-appearance
        color: #fff
        padding: 0.9em 0 1rem $sidebar-padding
        position: relative
        text-align: left
        width: 100%

        &:before
          $tri-size: 0.4em
          content: ''
          border: $tri-size solid transparent
            bottom: none
            top-color: #fff
          left: 1em
          position: absolute
          top: 1.4em
          transform: rotate(-90deg)

        h2
          font-family: $font-heading
          font-size: 1.2em
          font-weight: bold

      .api-section-objects
        display: none

      &.expanded
        .api-section-header:before
          transform: rotate(0deg)
        .api-section-objects
          display: block

    .api-object
      .api-object-name
        background: $color-sidebar-bg3
        border-bottom: 0
        border-top: 3px solid $color-sidebar-bg
        box-shadow: 0 0.3rem 0 transparentize($color-sidebar-bg3, 0.6)
        font-family: $font-monospace
        font-size: 1.6em
        font-weight: normal
        padding-left: $sidebar-padding
        position: sticky
        top: 5.5rem
        z-index: $z-toc-api-object

        &:hover
          background: $color-sidebar-bg-active

      ul
        padding-bottom: 0

      .api-object-sections
        display: none

      &.navigated .api-object-name
        background: $color-accent

      &.navigated, &.match
        .api-object-sections
          display: block

    .api-objsection
      padding-bottom: 0.8em

      .api-objsection-name
        border-bottom: none
        color: #aaa
        font-family: $font-body
        font-size: 1.2em
        padding: 0.5em 0 0.25em $sidebar-padding

        &:hover
          background: inherit
          text-decoration: underline

    .api-objsection-members li:last-child .api-member-name
      border-bottom: none

    .api-member
      position: relative

      .api-member-name
        font-family: $font-monospace
        font-size: 1.2em
        padding: 0.5em
          left: $sidebar-padding

      .api-member-return-type
        background: #111
        border-radius: 0.15em
        font-family: $font-monospace
        padding: 0.3em 0.4em 0.2em
        pointer-events: none
        position: absolute
        right: 0.8em
        top: 0.5em

    &.finding
      .api-object, .api-objsection, .api-member
        display: none
        &.match
          display: block

#main
  background: $color-bg
  margin-left: $sidebar-width
  min-height: calc(100vh - #{2 * $main-padding + $header-height})
  padding: $main-padding
    top: $header-height + $main-padding

#repl .repl
  display: none

#repl.activated
  $repl-width: 40vw
  $repl-full-width: 70vw

  .repl
    animation-duration: 0.3s
    animation-name: 'right-motion'
    animation-timing-function: $ease-extreme-out
    animation-iteration-count: 1
    background: rgba(244, 244, 244, 0.98)
    bottom: 0
    box-shadow: inset 16.4rem 0 0 #eee, -5px 0 0 rgba(0, 0, 0, 0.45)
    display: block
    position: fixed
    right: -1 * $repl-width
    top: 0
    transition: width 0.2s $ease-extreme-out
    width: $repl-width
    z-index: $z-repl

    &.has-pins
      right: -1 * $repl-full-width
      width: $repl-full-width

  &.active .repl
    animation-name: 'left-motion'
    right: 0


#flyouts .flyout
  position: absolute
  z-index: $z-flyout

#sheets
  bottom: 0
  left: 0
  padding: 2em
  position: fixed
  max-width: 75vw
  z-index: $z-sheets

  .sheet
    animation-duration: 0.2s
    animation-name: 'up-motion'
    animation-timing-function: $ease-extreme-out
    animation-iteration-count: 1
    float: left
    margin: 1em
    width: 42rem

#tooltip
  background: #fff
  border-top: 1px solid $color-accent
  box-shadow: 0 0.3em 0.3em rgba(0, 0, 0, 0.07)
  font-size: 1.2em
  margin: 0.6em 0
  padding: 0.3em 0.5em 0.4em
  pointer-events: none
  position: absolute
  z-index: $z-tooltip
  &.disabled
    border-top-color: #999
    color: #aaa

footer
  display: none // for now


////////////////////////////////////////
// LAYOUT: lesser widths

@media (max-width: 1260px)
  #main
    .sample-code
      float: none

    .sample-result
      padding-top: 3em


@media (max-width: 810px)
  header
    &:before
      box-shadow: 0 0 1.2em rgba(0, 0, 0, 0)
      width: 85rem
    &:after
      display: none
    .header-right
      left: 22rem

    #show-toc
      display: block

  #left
    box-shadow: 0 0 0.6em rgba(0, 0, 0, 0)
    left: 100vw
    transform: translateX(0)
    transition: transform 0.3s ease-in
    z-index: $z-mobile-toc

  #main
    margin-left: 0
    transition: filter 0.1s

  .show-toc
    #show-toc:after
      transform: rotate(-90deg)

    #left
      box-shadow: 0 0 1.4em rgba(0, 0, 0, 0.6)
      transform: translateX(#{-1 * $sidebar-width})
      transition: transform 0.3s $ease-extreme-out
    #main
      filter: blur(0.2em)

@media (max-width: 600px)
  header .header-right
    left: $logo-size
    padding: 6em
    top: 1.5em

    nav
      font-size: 1.5em


////////////////////////////////////////
// LAYOUT: flyouts

.flyout
  .janus-inspect-panel
    min-width: 30em

    &.janus-inspect-varying
      min-width: 40em



////////////////////////////////////////////////////////////////////////////////
// CONTENT

////////////////////////////////////////
// CONTENT: main article

.article
  h1, h2
    color: $color-heading
    font-family: $font-heading
    font-weight: 500
    letter-spacing: -0.02em
    margin-bottom: 0.4em
    padding-top: 0.8em
  h1
    font-size: 3em
  h2
    font-size: 2em

  h1, h2, h3
    a.anchor
      $dist: $header-height + $main-padding
      display: block
      margin-top: -$dist
      padding-top: $dist
      pointer-events: none

    a.self-link
      color: #ccc
      margin-left: 0.8rem
      visibility: hidden

      &:hover
        color: #666

    &:hover a.self-link
      visibility: visible

  p
    font-size: 1.6em
    line-height: 1.3em
    margin-bottom: 1.5em
    max-width: $main-max-width

    &.splash
      color: $color-splash
      font-family: $font-heading
      font-size: 3em
      letter-spacing: -0.02em

      .splash-two
        color: $color-accent2

    + ul
      margin-top: -1em

  > ul, > ol
    $padding-left: 2em
    max-width: calc(#{$main-max-width} - #{$padding-left})
    padding-bottom: 1em
    padding-left: $padding-left

    ul, ol
      padding-left: 1.2em
      padding-top: 0.5em

    > li
      font-size: 1.6em
    li
      padding-bottom: 0.5em

      ul, ol
        li:last-child
          padding-bottom: 0

  > ul, > ul ul, > ol ul
    list-style-type: circle

  > ol, > ol ol, > ul ol
    list-style-type: decimal

  p, > ul, > ol
    a
      border-bottom: 1px dotted $color-accent
      color: $color-accent
      text-decoration: none

      &:hover, &:active, &:focus
        border-bottom-style: solid

      &:visited
        color: $color-accent2

    code
      background-color: #eee
      font-size: 1.2em

  blockquote
    background-color: #f0f0f0
    border-left: 0.6em solid #ddd
    margin-bottom: 2.5em
    max-width: 60rem
    padding: 1.3em
      left: 1.6em

    p, h1
      margin: 0
      padding: 0

    h1
      font-size: 1.8em
      padding-bottom: 0.3em

    p
      font-size: 1.4em
      + p
        padding-top: 0.8em

    code
      background-color: #ddd

    pre
      font-size: 1.6em
      padding: 0.4em 0
      code
        background-color: transparent

  .feature // TODO: move this out.
    svg
      $size: 8em
      float: left
      height: $size
      margin-right: 1.5em
      margin-top: 1em
      width: $size

      path
        fill: #aaa

    p
      margin-bottom: 0.5em

    + p
      margin-top: 2em

    h2 a.self-link
      display: none

////////////////////////////////////////
// CONTENT: API reference

.apiref
  h3
    background-color: #eee
    border-top: 2px solid #bbb
    box-shadow: 0 0.2em 0 #ebebeb inset
    font-family: $font-monospace
    font-size: 2em
    margin: 0 #{-$main-padding}
    padding: 0.8em $main-padding

    &.level-class.type-method
      border-top-color: #92a
    &.level-instance.type-method
      border-top-color: $color-accent

  h4
    background-color: #eee
    border-top: 1px solid #e4e4e4
    font-family: $font-monospace
    font-size: 1.3em
    margin: 0 #{-$main-padding} 1.5em
    padding: 1em $main-padding

    .annotation
      background: $color-accent2
      border-radius: 0.2em
      color: #fff
      font-size: 0.8em
      font-weight: normal
      margin-left: 1em
      padding: 0.3em 0.4em 0.2em

  h3 + h4
    border-top: none
    margin-top: -0.7em
    padding-top: 0

  h4 + h4
    border-top: none
    margin-top: -1.8em

  h3 + p
    padding-top: 1em

  .sample
    background-color: #f4f4f4
    border: none
    margin-top: -0.8em
    padding: 1.4em $main-padding 1em

    .sample-result
      &:before
        display: none

      .eval-success
        font-family: $font-monospace

        > .janus-list > li
          &:first-child
            padding-top: 0.3em
          &:last-child
            padding-bottom: 0.3em

          > .janus-inspect-list.janus-inspect-entity > .entity-content > .list-values > ul > li
            display: block
            padding-left: 1em

            &:first-child:last-child
              display: inline
              padding-left: 0

      .janus-inspect-entity .entity-content
        margin-left: -0.5em

      .janus-inspect-panel .janus-inspect-entity .entity-content
        margin-left: -0.2em

    .sample-error
      margin-bottom: -1em
      padding-top: 1em


////////////////////////////////////////////////////////////////////////////////
// COMPONENTS

.sample
  $border-color: #e4e4e4

  background-color: #f0f0f0
  border-bottom: 1px solid $border-color
  border-top: 1px solid $border-color
  box-shadow: 0 0 0 0 transparentize($color-error, 0.92) // for the transition
  margin: 0.5em #{-$main-padding} 2em
  overflow: hidden
  padding: 2em $main-padding
  transition: 0.2s border-color, 0.2s box-shadow

  .sample-code
    float: left
    min-width: 65%

    .CodeMirror
      background: transparent
      font-family: $font-monospace
      font-size: 1.2em
      height: auto

      .CodeMirror-scroll
        height: auto

    .code-static
      padding: 0.4em

      code
        font-family: $font-monospace
        font-size: 1.2em

  .sample-result
    font-size: 1.2em
    overflow: hidden

    &:before
      content: 'Result'
      display: block
      font-family: $font-heading
      font-size: 1.5em

    .eval-success > .janus-list > li
      border-bottom: 1px dotted #999
      padding: 1em 0
      &:last-child
        border-bottom: none

    .janus-inspect-panel.janus-inspect-varying
      font-size: 0.8333em

      .title .className
        display: none

    .exception
      padding: 0
      .exception-expando
        bottom: 0
        right: 0

    h1
      font-size: 1.8em

  .sample-toolbar
    clear: left
    display: none
    float: left
    padding: 0.6em

    button
      @include no-appearance
      color: #666
      margin-right: 1.2em
      transition: color 0.3s
      &:hover
        color: $color-accent
        transition: none
      &:before
        font-size: 1.4em
      &.disabled
        color: #d4d4d4
        &:hover
          color: #d4d4d4

    .sample-revert:before
      @include icon($icon-revert)
    .sample-transfer:before
      @include icon($icon-console-add)

  &.activated .sample-toolbar
    animation-duration: 1s
    animation-name: 'expand-margin'
    animation-timing-function: $ease-extreme-out
    animation-iteration-count: 1
    display: block

  &.noexec .sample-result,
  &.noexec.activated .sample-toolbar,
  &.custom-view.error .sample-result
    display: none

  .sample-error
    clear: both
    max-height: 0
    margin: 0 -4em -2em
    overflow: hidden
    padding-top: 2em
    transition: 0.6s max-height

    .exception
      background-color: $border-color
      color: #fff
      padding: 1.2em 4em 1em
      transition: 0.2s background-color

      .exception-expando
        display: none

  &.error
    border-color: $color-error
    box-shadow: 0 0 0 4px transparentize($color-error, 0.92)

    .sample-result:before
      content: 'Last Successful Result'

    .sample-error
      max-height: 9em
      .exception
        background-color: $color-error

.context-view .context-switcher button
  @include no-appearance
  position: absolute
  right: 0
  top: 0

  &:after
    @include icon($icon-window)
    font-size: 1.2em

  &:hover:after
    color: $color-accent

.CodeMirror.cm-s-default
  .CodeMirror-activeline-background
    background: #f7f7f7
  .cm-def
    color: #007ec7
  .cm-keyword
    color: #037d7d
  .CodeMirror-nonmatchingbracket
    background: #ecc
    color: inherit
  .cm-property
    color: #666
  .cm-string, .cm-string-2
    color: #0c820a
  .cm-trailingspace
    background: #e3e3e3
  .cm-variable
    color: #7c00bb

  &.CodeMirror-focused
    .CodeMirror-matchingbracket
      background: #d7d7d7
      color: inherit

.exception
  animation-duration: 1s
  animation-timing-function: $ease-extreme-out
  animation-iteration-count: 1
  background-color: $color-error
  color: #fff
  padding: 1em
  position: relative

  .exception-message
    font-family: $font-monospace
    font-size: 1.2em

  .exception-stack
    li ~ li
      display: none

    a
      color: #fff
      cursor: text
      text-decoration: none
      &.navigable
        cursor: pointer
        text-decoration: underline

  .exception-expando
    bottom: 1em
    position: absolute
    right: 1em

    button
      @include no-appearance
      padding: 0.2em

      &:before
        $size: 7px
        @include reify
        border-right: 2px solid #fff
        border-bottom: 2px solid #fff
        cursor: pointer
        height: $size
        transform: rotate(45deg)
        transition: 1s transform $ease-extreme-out
        width: $size

      &.checked:before
        transform: rotate(-135deg)

  &.exception-name-SyntaxError
    .exception-stack, .exception-expando
      display: none

  &.has-expanded 
    animation-name: contract-margin

  &.expanded
    animation-name: expand-margin

    .exception-stack li ~ li
      display: block

.stack-line
  .stack-line-context.no-context
    opacity: 0.3

.view
  .view-error.has-error
    background-color: $color-error
    color: #fff
    margin-top: 1em
    padding: 1em
      top: 0.9em

    &:before
      content: 'Runtime Error'
      font-weight: bold

    .exception-message
      padding: 0.1em 0 0.5em


////////////////////////////////////////
// COMPONENTS: repl

$repl-chrome-padding: 1em
$repl-chrome-width: 2.4em
$repl-chrome-outer-width: (2 * $repl-chrome-padding) + $repl-chrome-width
$repl-chrome-color-fg: #666
$repl-chrome-color-bg: #d4d4d4
$pin-color-bg: #ddd
$pin-chrome-padding: 0.4em
$pin-chrome-width: 1.6em
$pin-chrome-outer-width: (2 * $pin-chrome-padding) + $pin-chrome-width

.repl

  .repl-chrome
    background: $repl-chrome-color-bg
    bottom: 0
    left: 0
    padding: $repl-chrome-padding
    position: absolute
    top: 0
    width: $repl-chrome-width

    button
      @include no-appearance
      margin-bottom: 1em
      padding: 0.1em
      &:before
        @include icon($icon-close-circle)
        color: $repl-chrome-color-fg
        font-size: 2em

    h2
      color: $repl-chrome-color-fg
      cursor: default
      font-family: $font-monospace
      margin-bottom: 4em
      margin-left: 1.45em
      text-align: center
      text-transform: lowercase
      transform: rotate(90deg)
      transform-origin: left top
      white-space: nowrap

  .repl-main
    @include custom-scrollbar(#777, #ccc)
    bottom: 0
    cursor: text
    left: $repl-chrome-outer-width
    overflow-x: auto
    overflow-y: auto
    position: absolute
    right: 0
    top: 0

    > .janus-list
      counter-reset: line-number
      > li
        counter-increment: line-number
        .repl-statement-placeholder:after
          content: counter(line-number)

  .repl-statement
    border-bottom: 1px dotted #ddd
    overflow: hidden

  .repl-pins
    @include fill
    background-color: $pin-color-bg
    border-left: 1px solid #c4c4c4
    display: none
    left: auto

    .repl-chrome
      border-right: 1px dotted #e6e6e6

      button:before
        content: $icon-close

    .repl-pins-list
      margin-left: $repl-chrome-outer-width
      overflow-y: auto

      > .janus-list > li
        border-top: 1px dotted #c4c4c4
        &:first-child
          border-top: none

    .janus-inspect-panel .panel-title .janus-inspect-pin
      display: none

  &.has-pins
    $pins-width: 45em

    .repl-main
      right: $pins-width

    .repl-pins
      box-shadow: #{$repl-chrome-outer-width + $pin-chrome-outer-width} 0 0 $repl-chrome-color-bg inset
      display: block
      width: $pins-width

  li:last-child .repl-statement
    border-bottom: none

.repl-statement
  $placeholder-color: #888
  padding: 0.8em 1.3em
    left: 0.8rem + $repl-left-gutter
  position: relative

  .CodeMirror
    background: transparent
    font-family: $font-monospace
    font-size: 1.2em
    height: auto

    .CodeMirror-scroll
      height: auto

  .repl-statement-placeholder
    // TODO: sort of a mess but i just want this to work.
    color: $placeholder-color
    font-family: $font-monospace
    font-size: 1.1em
    left: 0
    padding: 0.5em 0
    pointer-events: none
    position: absolute
    text-align: right
    width: calc(#{$repl-left-gutter} - 2.5em)
    &:after
      padding-left: 0.3em

  .repl-statement-name
    font-family: $font-monospace
    font-size: 1.4em
    left: 0
    padding-top: 0.15em
    position: absolute
    width: $repl-left-gutter

    input
      @include no-appearance
      color: $color-text
      font-family: $font-monospace
      margin-right: 0.4em
      text-align: right
      width: calc(100% - 2.5em)

    &:after
      color: $placeholder-color
      content: '>'

  &.named
    .repl-statement-placeholder
      display: none
    .repl-statement-name:after
      color: $color-text
      content: '='

  .repl-statement-result
    padding-top: 0.6em
    position: relative

    .janus-literal
      font-size: 1.2rem

    .entity-title, .entity-content:before, .entity-content:after
      font-family: $font-monospace
      font-size: 1.2rem

    .entity-content .janus-literal,
    > .eval-success > .janus-list > li > .janus-literal
      font-family: $font-monospace

    .janus-inspect-panel
      clear: left

.pin
  overflow: hidden
  position: relative

  .pin-chrome
    @include fill
    padding: 1em $pin-chrome-padding
    right: auto
    width: $pin-chrome-width

    button
      @include no-appearance
      &:before
        @include icon
        color: $repl-chrome-color-fg
        font-size: 1.6em

    .pin-remove:before
      content: $icon-close-small

    .pin-expand button
      &:before
        content: $icon-chevron-right
      &.checked:before
        content: $icon-chevron-down

  .pin-contents
    animation-duration: 1s
    animation-name: 'contract-margin'
    animation-iteration-count: 1
    animation-timing-function: $ease-extreme-out
    margin-left: $pin-chrome-outer-width
    max-height: 3.6em
    padding: 1em

  &.expanded .pin-contents
    animation-name: 'expand-margin'
    max-height: none

  &:after
    @include reify
    @include fill
    background: rgba(0, 0, 0, 0.1)
    height: 0.2em
    top: auto
  &.expanded:after
    display: none

.valuator
  box-shadow: 12em 0 #eee inset
  max-height: 80vh
  overflow-y: auto

  .repl-statement-placeholder
    display: none

  .valuator-line
    border-bottom: 1px dotted #ddd
    position: relative

    .valuator-statement
      margin-right: 2em

    .code-editor
      min-height: 2.5em // TODO: not sure why this is necessary.

  li:last-child .valuator-line
    border-bottom: none

  .valuator-accept
    @include no-appearance
    @include fill
    background: #3dafaf
    border-left: 1px dotted #ddd
    left: auto
    width: 2em

    &.disabled
      background: transparent

    &:before
      @include icon($icon-chevron-right)
      bottom: 0.3em
      color: #fff
      font-size: 1.5em
      left: 0.2em
      position: absolute
    &.disabled:before
      color: #ccc

    &:hover
      background: $color-accent2
    &.disabled:hover
      background: transparent


////////////////////////////////////////
// COMPONENTS: misc

.flyout
  box-shadow: $subtle-shadow

// we end up redoing the panel styles a little here, but we don't want to actually
// inherit all of panel's particular quirks so we sort of have to.
.sheet
  background-color: #f7f7f7
  box-shadow: $subtle-shadow
  position: relative

  .sheet-header
    background-color: $color-accent
    color: #fff
    font-size: 1.3em
    font-weight: bold
    padding: 0.5em

    .sheet-close
      @include no-appearance
      color: #fff
      position: absolute
      right: 0.8em
      top: 0.8em

      &:before
        @include icon($icon-close)


////////////////////////////////////////
// COMPONENTS: inspect

.janus-inspect-entity
  .entity-title
    cursor: default

.janus-inspect-panel
  background-color: #fff
  border-radius: 0.2em
  font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif
  position: relative

  .panel-title
    background-color: $color-accent
    border-radius: 0.2em 0.2em 0 0
    color: #fff
    font-size: 1.3em
    font-weight: bold
    padding: 0.5em
      bottom: 0.6em

    .janus-inspect-pin
      @include no-appearance
      display: block
      right: 0.6em
      position: absolute
      top: 0.85em
      z-index: 1

      &:before
        @include icon($icon-pin)
        color: #fff
        font-size: 1.2em

  .panel-content
    padding: 1em

  .panel-sidebar
    $sidebar-width: 14em
    @include fill
    left: auto
    width: $sidebar-width

    .panel-sidebar-title
      background-color: $color-accent2
      border-top-right-radius: 0.2em
      color: #fff
      font-size: 1.1em
      font-weight: bold
      padding: 0.8em

    .panel-sidebar-content
      @include fill
      background-color: #eee
      overflow-x: hidden
      overflow-y: auto
      top: 3em

    ~ .panel-content
      margin-right: $sidebar-width

.janus-inspect-kvPair
  font-size: 1.2rem
  padding-bottom: 0.15em
  .kvPair-valueBlock
    line-height: 1.4em
    margin-right: 1em // make room for the list + button
  .kvPair-clear
    cursor: default
    opacity: 0
    transition: 0.4s opacity
    &:before
      @include icon($icon-delete)
      color: #aaa
    &:hover:before
      color: $color-error
  &:hover .kvPair-clear
    opacity: 1
    transition-duration: 0

.janus-inspect-varying.janus-inspect-panel
  .varying-snapshot
    background-color: #fadd00 // TODO: copied from -inspect
    border-radius: 0.2em
    color: $color-text
    font-size: 0.8rem
    margin-left: 0.3em
    padding: 0.2em 0.4em
      right: 1.8em

    .varying-snapshot-close
      color: $color-text
      display: inline-block
      font-size: 1.6em
      line-height: 0.9em
      margin-left: 0.2em
      overflow: hidden
      position: absolute
      text-decoration: none
      width: 0.6em

      &:before
        content: '×'
        padding-right: 1em

  .panel-content > .varying-tree
    padding-top: 0.4em

  .varying-inert
    color: #777
    padding-bottom: 0.8em

    a
      color: $color-accent2

  .varying-reactions
    li:nth-child(2n)
      background-color: #f7f7f7

    .janus-list-selectItem
      position: relative

      &.checked
        background-color: #fff
        box-shadow: -0.2em 0 0 $color-accent inset

      > button
        @include fill
        cursor: default
        opacity: 0
        width: 100%

      .reaction
        padding: 0.3em 0.6em

.varying-delta .separator:before
  @include icon($icon-arrow-right)
  font-size: 0.8rem

.janus-inspect-function
  &.janus-inspect-entity > .entity-content
    // TODO: will probably cause sizing problems with nested entities later.
    font-size: 1.2rem

  &.janus-inspect-panel
    .function-args
      padding-bottom: 0.6em

      &.inline > ul > li
        display: inline
        &:after
          content: ', '
        &:last-child:after
          content: none

      .janus-inspect-applicant
        font-size: 1.2rem

        .applicant-name
          color: $color-accent2

    .function-body
      $padding-h: 0.8em
      background-color: #f4f4f4
      display: block
      font-family: $font-monospace
      font-size: 1rem
      max-height: 30em
      min-width: calc(100% - #{$padding-h * 2})
      overflow-x: auto
      overflow-y: auto
      padding: 0.6em $padding-h

.janus-inspect-list.janus-inspect-panel
  .list-entry
    padding-bottom: 0.2em

    hr
      border: none
        top: 1px dotted #999
      left: 0
      margin-top: -0.3em
      position: absolute
      right: 3em

  .list-insert
    @include no-appearance
    color: #666
    &:before
      @include icon($icon-add)
    &:hover, &.valuating
      color: $color-accent2

    &.list-insert-last
      margin-top: 0.5em

  .list-list
    cursor: default

    .list-insert
      margin-top: -0.8rem
      opacity: 0
      position: absolute
      right: 1em
      transition: 0.4s opacity
      &:hover, &.valuating
        opacity: 1
        + hr
          display: block

    > ul > li:hover
      .list-insert, + li .list-insert
        opacity: 1
        transition-duration: 0

  .kvPair-key
    color: #bbb
    font-size: 1rem
    font-weight: normal
    line-height: 1.6em
    vertical-align: bottom
    &:after
      content: none
  li:nth-child(10n+1) .kvPair-key
    color: #666

  .list-more
    margin: 0.3em 0 0.8em

  .list-last-item
    cursor: default

.janus-inspect-list
  .list-more
    @include no-appearance
    border-bottom: 1px dotted #777
    display: none
    &.has-more
      display: inline

.janus-inspect-domview.janus-inspect-panel
  .domview-mutations > ul > li
    padding-bottom: 0.8em
    &:last-child
      padding-bottom: 0

  .mutation-selector
    color: $color-accent2
    font-family: $font-monospace
    font-size: 1.2rem
    &.repeated
      display: none

  .mutation-type
    font-size: 1.2rem
    padding-left: 0.5em
  .mutation-operation
    font-weight: bold
  .mutation-param.has-param
    &:before
      content: '('
      font-weight: bold
    &:after
      content: ')'
      font-weight: bold

  .mutation-binding
    font-size: 1.1rem

  .domview-display
    position: relative

    .domview-display-label
      border-top: 1px dotted #ccc
      font-weight: bold
      left: -1em
      padding: 0.5em 1em
      position: absolute
      right: -1em
      top: 1em

    > :first-child
      padding-top: 3.5em


////////////////////////////////////////
// COMPONENT: thinker

$thinker-offset: 4em
$thinker-angle: 0.436rad
$thinker-size: 7em
$thinker-effect-height: 60em
#thinker
  background: radial-gradient(#ddd, #d4d4d4)
  bottom: $thinker-offset
  clip-path: circle()
  height: $thinker-size
  opacity: 0
  pointer-events: none
  position: fixed
  right: $thinker-offset
  transition: 0.5s opacity
  width: $thinker-size

  &.thinking
    opacity: 0.85
    transition-delay: 0.3s // wait a moment before showing

    div:before, div:after
      animation-name: thinker

.thinker-1, .thinker-2, .thinker-3, .thinker-4
  height: 100%
  overflow: hidden
  position: absolute

  &:before, &:after
    animation-iteration-count: infinite
    animation-timing-function: linear
    content: ''
    display: block
    height: $thinker-effect-height
    position: absolute
    width: 100%

  $transparent: transparentize($color-bg, 1)
  &:before
    animation-duration: 2s
    background: linear-gradient($transparent, $color-bg, $transparent)

  &:after
    animation-duration: 0.8s
    background: linear-gradient($transparent, transparentize($color-bg, 0.6), $transparent)

.thinker-1, .thinker-2
  top: $thinker-size * -0.12
  width: $thinker-size * 0.1265

.thinker-1
  left: $thinker-size * 0.228
  transform: rotate($thinker-angle)
  &:after
    animation-delay: 0.25s;

.thinker-2
  right: $thinker-size * 0.24
  transform: rotate(-1 * $thinker-angle)
  &:before
    animation-delay: 0.1s;
  &:after
    animation-delay: 0.3s;

.thinker-3, .thinker-4
  top: $thinker-size * 0.07
  width: $thinker-size * 0.088

.thinker-3
  left: $thinker-size * 0.317
  transform: rotate(-1 * $thinker-angle)
  &:before
    animation-delay: 0.2s;
  &:after
    animation-delay: 0.2s;

.thinker-4
  right: $thinker-size * 0.33
  transform: rotate($thinker-angle)
  &:before
    animation-delay: 0.4s;


////////////////////////////////////////////////////////////////////////////////
// KEYFRAMES
// this is at the bottom because the vim sass highlighting freaks out about it.

@keyframes contract-margin
  from
    margin-bottom: 12px
  to
    margin-bottom: 0

@keyframes expand-margin
  from
    margin-bottom: -12px
  to
    margin-bottom: 0

@keyframes thinker
  from
    top: -1 * $thinker-effect-height - $thinker-size
  to
    top: $thinker-size

@keyframes left-motion
  from
    transform: translateX(60px)
  to
    transform: translateX(0)

@keyframes right-motion
  from
    transform: translateX(-60px)
  to
    transform: translateX(0)

@keyframes up-motion
  from
    transform: translateY(20px)
  to
    transform: translateY(0)

